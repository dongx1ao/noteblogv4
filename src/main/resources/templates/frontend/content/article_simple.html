<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta th:replace="frontend/fragment/style"/>
    <title th:text="${article.title}"></title>
    <link href="/static/assets/css/frontend/simple.css" type="text/css" rel="stylesheet">
    <link href="/static/assets/css/frontend/simple_article.css" type="text/css" rel="stylesheet">
    <link href="/static/plugins/editormd/css/editormd.preview.min.css" rel="stylesheet" type="text/css">
</head>
<body class="layui-anim layui-anim-fadein simple">
<div id="article-app">
    <bmy-header-mini :params="params" :st="st" :title="title" :bodyid="bodyId" :show-small="false"></bmy-header-mini>
    <hr class="header-hr">
    <bmy-article-page-mini :article="article" :author="author" :comments="comments.totalElements"
                           :name="params.website_title" :tags="tags" :similars="similars"
                           :alipay="params.alipay" :wechat="params.wechat_pay" :su="su">

        <bmy-comment v-show="params.all_comment_open == 1 && article.commented" slot="post" :id="article.id"
                     :su="su"></bmy-comment>

        <bmy-similar :articles="similars" slot="similar"></bmy-similar>

        <bmy-comment-list slot="comment" :comments="comments" :tips="params.comment_notice"
                          :re="params.all_comment_open == 1 && article.commented"></bmy-comment-list>

    </bmy-article-page-mini>

    <bmy-footer :words="params.footer_words"></bmy-footer>
</div>

<div th:replace="frontend/fragment/script"></div>
<script src="/static/assets/js/frontend/svg.js"></script>
<script src="/static/plugins/editormd/lib/marked.min.js"></script>
<script src="/static/plugins/editormd/lib/prettify.min.js"></script>
<script src="/static/plugins/editormd/lib/raphael.min.js"></script>
<script src="/static/plugins/editormd/lib/underscore.min.js"></script>
<script src="/static/plugins/editormd/lib/flowchart.min.js"></script>
<script src="/static/plugins/editormd/lib/jquery.flowchart.min.js"></script>
<script src="/static/plugins/editormd/lib/sequence-diagram.min.js"></script>
<script src="/static/plugins/editormd/editormd.min.js"></script>
<script th:inline="javascript">
    layui.use(['layedit', 'laypage', 'code'], function () {
        var layedit = BMY.layedit = layui.layedit;
        var laypage = layui.laypage;

        laypage.render({
            elem: $(".comment-page")
            , count: [[${comments.totalElements}]]
            , layout: ['prev', 'next']
            , jump: function (obj, first) {
                if (!first) {
                    layer.msg('第 ' + obj.curr + ' 页');
                    $.post("/article/comments", {
                        id: BMY.articleVM.article.id
                        , pageNo: obj.curr
                    }, function (cs) {
                        BMY.articleVM.comments = cs;
                    })
                }
            }
        });
        BMY.articleVM = new Vue({
            el: "#article-app",
            data: {
                params: [[${settings}]]
                , bodyId: "blog-body"
                , article: [[${article}]]
                , st: true
                , title: [[${article.title}]]
                , tags: [[${tags}]]
                , author: [[${author}]]
                , cates: [[${cateList}]]
                , similars: [[${similarArticles}]]
                , su: [[${su}]]
                , showInfoLabel: false
                , comments: [[${comments}]]
            }
            , mounted: function () {
                var that = this;
                if (!BMY.detectmob()) {
                    var mdContent = that.article.mdContent;
                    if (mdContent.indexOf('[TOC]') > -1 || mdContent.indexOf('[TOCM]') > -1) {
                        layer.open({
                            type: 1
                            , title: '文章目录'
                            , area: ['200px', '400px']
                            , maxmin: true
                            , shade: 0
                            , offset: 'r'
                            , content: $("#custom-toc-container")
                            , zIndex: 19930917
                        });
                    }
                }
                BMY.editor = layedit.build('comment-input', {
                    tool: ['face', '|', 'left', 'center', 'right', 'link', 'unlink']
                    , height: 150
                });
            }
        });
    });
</script>

</body>
</html>